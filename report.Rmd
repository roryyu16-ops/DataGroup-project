---
title: "IDS Project"
author: "by Artery Party: Roderick Yu, Yufei Xiang, Hoddy Zhu, Lincoln Luk"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r load-lib, include = FALSE}

library(tidyverse)
library(tidymodels)


```


```{r load-data, include=FALSE}

MArea <- read_csv("data/HDM_CouncilArea.csv")
CouncilArea <- read_csv("data/CouncilArea.csv")


Data<- MArea %>%
  select(Year,CA,AgeGroup,Sex,Diagnosis,CrudeRate,EASR,NumberOfDeaths) %>%
  drop_na()


```


## Research Question

Our main research question is to explore the overall trends of heart disease mortality in Scotland, and to identify how mortality rates vary across different demographic categories, such as gender, geographical area, age group, and year.

Our aim was to find any long-term patterns or if there were more predominant groups of people which show higher mortality rates.

This particular dataset interested our group as heart diseases can affect anyone and is also known as one of the main causes of death globally. We all have a risk of getting heart disease and it was interesting to us to find what group of people are most at risk. 


## Data Overview

We are using the 'Heart Disease Mortality by Council Area' dataset from the Scottish Heart Disease Statistics from the Public Health Scotland NHS website, which we named "MArea". 

This dataset consists of 17820 rows and 14 variables (columns). 

Our focus was on the different demographic and geographic categories, so from the start we cleaned up the data from "MArea" into "Data" where there are 7230 rows and 7 variables:

- Year – year of recorded data
- CA – council area code
- AgeGroup – categorical age group
- Sex – male or female
- Diagnosis – specific heart-disease-related diagnosis
- CrudeRate – raw mortality rate
- EASR – European Age-Standardised Rate, allowing better comparisons across groups

This allowed us to conduct our findings more easily and made the data look less messy and easier to look at, as we removed the unnecessary variables, duplicated measures, and variables irrelevant to our research question.

Additionally to support our research aim, we made additional variables to categorise our data better and so we could analyse and evaluate the data more easily. The additional variables will be mentioned in the findings.

## Exploratory Statistics

We began by 

```{r, echo = FALSE}
Data %>%
  group_by(AgeGroup) %>%
  summarise(mean_cruderate = mean(CrudeRate , na.rm = TRUE),
            median_cruderate = median(CrudeRate , na.rm = TRUE)) 

Data %>%
  group_by(Sex) %>%
  summarise(mean_cruderate = mean(CrudeRate , na.rm = TRUE),
              median_cruderate = median(CrudeRate , na.rm = TRUE)) 

Data %>%  
  group_by(Diagnosis) %>%
  summarise(mean_cruderate = mean(CrudeRate , na.rm = TRUE),
              median_cruderate = median(CrudeRate , na.rm = TRUE)) 
```

Extreme age dependence:
The average CrudeRate (314.0) of the population aged 75 and above is tens to hundreds of times higher than other age groups, with a median of 63.0, indicating a significant concentration of risk in this group.
The median of the population under 75 years old is 0, but the average is 4.15, indicating that a few high-value individuals have raised the mean and the overall distribution is highly skewed to the right.

Full data conceals the truth:
The mean and median of "all ages" are close (72.8 vs 72.3), but after splitting, it can be seen that the age stratification effect is extremely strong, and directly using global statistics will ignore high-risk elderly groups.

Suggestion: 
Public health resources should prioritize the population aged 75 and above, and further analyze high-value outliers for the<75 age group.

Significant gender differences:
The average CrudeRate of males (47.9) is 72% higher than that of females (27.8), but the median for both is 0, indicating that most individuals have no events, but males have more extreme high-risk cases.
The global median (1.95) falls between males and females, indicating that the dataset may contain mixed gender ratios.

Clear classification of disease severity:

Coronary heart disease: The mean and median values are close (116.0 vs 112.0), indicating a relatively symmetrical data distribution, stable risk, and generally high risk.
Heart failure: The mean (2.32) is much higher than the median (0), indicating that the vast majority of cases have no events, but there are a small number of individuals with extremely high risk.

Clinical priority ranking:
Coronary heart disease>heart attack>heart failure, which conforms to the common sense of disease mortality rate, but it is necessary to be alert to outliers in heart failure.

## Findings

Think of this as the text of your presentation with some extra detail to cover what there was not time to discuss in the presentation. This might include any assumptions you made when doing your analysis, any limitations of the work you have done or any ideas you have for future work. Feel free to split this section into subsections to make it easier to read. 

The length should be roughly 1,500 words. 

You can also load your data here and present any analysis results / plots.
Make sure to hide your code with  `echo = FALSE` unless the point you are trying to make is about the code itself, in which case you should show your code.


## Data Visualisations

### 1. EASR

Firstly, we compared the EASR and crude rate in this dataset. The EASR is the European Age-Sex standardised rate per 100,000 population. It is adjusted for the age distribution using a standard population (100,000) and provides a more valid and unbiased comparison than crude rate.

```{r,echo=FALSE, message= FALSE}
# Chart of EASR

ggplot(data = Data,
       mapping = aes(x = EASR, 
                     y = CrudeRate, 
                     )) +
  geom_point(size = 1)+
  geom_smooth(method = lm , se = FALSE)
```

We used the EASR and plotted it against crude rate to see how reliable and it was and we plotted a line of best fit, which had a gradient of 1. This shows that crude rate is very reliable and we can confidently use it to compare evaluate the data, as their correlation is near perfect. Therefore we used the crude rate instead of EASR for the rest of the investigation.


### 2. Geographical area

To start off, we tried to find if there were differences in mortality rate for each region of Scotland.
We looked at the dataset CouncilArea from CouncilArea.csv and we manually matched each area with the council area codes in MArea (the original dataset) to each region (North, Central, South, etc.)

```{r, echo = FALSE, warning= FALSE}
#Chart of Area

CA_Regions <- Data %>% 
  filter(!CA %in% c("S92000003")) %>%
  mutate(
    Region = case_when(
      CA %in% c("S12000033", "S12000034", "S12000020", "S12000017") ~ "North",
      CA %in% c("S12000038", "S12000039", "S12000015","S12000047") ~ "North East",
      CA %in% c("S12000005", "S12000014", "S12000026", "S12000036", "S12000042", "S12000044","S12000048") ~ "Central",
      CA %in% c("S12000006", "S12000010", "S12000019", "S12000028", "S12000045") ~ "South",
      CA %in% c("S12000008", "S12000009", "S12000011", "S12000018", "S12000021", "S12000023", "S12000027", "S12000030", "S12000035", "S12000040", "S12000041","S12000013","S12000029","S12000049","S12000050") ~ "West",
      TRUE ~ "Others"
      )
  )


CA_summary <- CA_Regions %>%
  group_by(Region) %>%
  summarise(
    mean_deaths = mean(NumberOfDeaths, na.rm = TRUE),
    mean_rate  = mean(CrudeRate, na.rm = TRUE)
  )


  ggplot(CA_summary, aes(x = Region, y = mean_rate)) +
  geom_bar(stat = "identity") +
  labs(
    title = "Crude Mortality Rate by Council Area",
    x = "Region",
    y = "Mean Crude Mortality Rate"
  )
```

We found that there was not much variation across the regions, so the geographical location does not affect the crude rate for heart diseases, showing that this is not something we should keep looking into. This could mean that the risk factors such as oil intake or physical activity are quite similar throughout each region. So we decided to investigate the other factors in this dataset.


### 3. Sex 

Then, to visualise the how the crude rate differs between sex, we made a bar chart with the mean value of crude rates across all females and males. 

```{r, echo = FALSE, warning= FALSE}
# Bar chart of Sex
table_sex<-Data %>%
  group_by(Sex) %>%
  summarise(mean_cruderate = mean(CrudeRate , na.rm = TRUE),
            median_cruderate = median(CrudeRate , na.rm = TRUE))

ggplot(table_sex)+
       geom_bar(mapping= aes (x=Sex,
                     y=mean_cruderate,
                     fill=Sex),
                     stat = "identity")+
  labs(title = "The mean value of cruderate for different Sexes",
       x="Sex",
       y="Mean Cruderate",
       fill="Sex")
```

We found that males have a significantly higher mean crude rate than females, almost double. This shows that males are more twice as likely to die from heart diseases than females. This may be caused by eating habits, physical activity, or even biological reasons. We figured this was worth looking into.


### 4. Age

We then investigated the different age groups differed in crude rate. 

```{r, echo = FALSE, warning= FALSE}
#Bar chart of Age
table_age<-Data %>%
  group_by(AgeGroup) %>%
  summarise(mean_cruderate = mean(CrudeRate , na.rm = TRUE),
            median_cruderate = median(CrudeRate , na.rm = TRUE))%>%
  mutate(AgeGroup = fct_relevel(AgeGroup, "All" ,after = 0))

ggplot(table_age)+
       geom_bar(mapping= aes (x=AgeGroup,
                              y=mean_cruderate,
                              fill=AgeGroup),
                              stat = "identity")+
  labs(title = "The mean value of cruderate for different AgeGroups",
       x="Age",
       y="Mean Cruderate",
       fill="AgeGroup")
```



### 5. Year

We then compared mean crude rate with year, visualising it with a line chart. 

```{r, echo = FALSE, warning= FALSE}
#line chart of year
summary_diagnosis <- Data%>%
  group_by(Year) %>%
   summarise(mean_cruderate = mean(CrudeRate , na.rm = TRUE))

ggplot(summary_diagnosis, aes(x = Year, y = mean_cruderate)) +
  geom_line(size = 1) +
  geom_point() +
  labs(
    title = "The mean value of cruderate over Years",
    x = "Year",
    y = "Mean Cruderate"
  ) +
  theme_minimal()
```

We found that the mean crude rate falls throughout the years until 2019, where it increases at a faster rate. This tells us that

### 6. Diagnosis

``` {r, echo = FALSE, warning= FALSE}
# Bar chart of Diagnosis
table_Diagnosis<-Data %>%
  group_by(Diagnosis) %>%
  summarise(mean_cruderate = mean(CrudeRate , na.rm = TRUE),
            median_cruderate = median(CrudeRate , na.rm = TRUE))

ggplot(table_Diagnosis)+
       geom_bar(mapping= aes (x=Diagnosis,
                     y=mean_cruderate,
                     fill=Diagnosis),
                     stat = "identity")+
  labs(title = "The mean value of cruderate for different Diagnosis",
       x="Diagnosis",
       y="Mean Cruderate",
       fill="Diagnosis")

```

### 7. Combining variables 

```{r, echo = FALSE, message= FALSE}
#Graph of the Year and Sex
  Table_6<-Data %>%
  group_by(Sex,Year) %>%
  summarise(mean_cruderate = mean(CrudeRate , na.rm = TRUE),
            median_cruderate = median(CrudeRate , na.rm = TRUE))
  
ggplot(Table_6, aes(x = Year, y = mean_cruderate, fill = Sex)) +
  geom_col(position = position_dodge(width = 0.8)) +
  labs(
    title = "Number of Deaths by Sex over Years",
    x = "Year",
    y = "Mean crude rate",
    fill = "Sex"
  )
```



We then plotted year against crude rate

```{r, echo = FALSE, message= FALSE}
#Graph of Year and Age
Table_7<-Data %>%
    group_by(AgeGroup,Year) %>%
    summarise(mean_cruderate = mean(CrudeRate , na.rm = TRUE),
              median_cruderate = median(CrudeRate , na.rm = TRUE)) 
  ggplot(Table_7, aes(x = Year, y = mean_cruderate, color = AgeGroup , group = AgeGroup)) +
    geom_line(size = 1) +
    geom_point() +
    labs(
      title = "Number of Deaths by AgeGroup over Years",
      x = "Year",
      y = "Number of Deaths"
    ) +
    theme_minimal()
```



### Summary 

Going through all these visualisations, we concluded that males aged over 75 are most likely to suffer from heart disease and that year

## Predictive Modelling





## Model Evaluation

Key findings:






## Conclusion







## References

Public Health Scotland (NHS Scotland, 2024) -- Scottish Heart Disease Statistics -- Heart Disease Mortality by Council Area
https://www.opendata.nhs.scot/dataset/scottish-heart-disease-statistics/resource/fc7b42f1-4de6-48dd-b640-613fb0aa427d
accessed (17/10/2025)

Public Health Scotland (NHS Scotland, 2020) -- Council Area 2011 - Council Area 2019 
https://www.opendata.nhs.scot/dataset/geography-codes-and-labels/resource/967937c4-8d67-4f39-974f-fd58c4acfda5
accessed (7/11/2025)
